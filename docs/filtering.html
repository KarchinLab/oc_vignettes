<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.45">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Filtering in OpenCRAVAT – OpenCRAVAT Vignettes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./making_annotator_modules.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./filtering.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Filtering in OpenCRAVAT</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">OpenCRAVAT Vignettes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">OpenCRAVAT Vignettes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started_web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started (Website/GUI)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started_cli.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Getting Started with OpenCRAVAT on the Command Line</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./making_annotator_modules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Making an Annotator Module</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./filtering.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Filtering in OpenCRAVAT</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-filter" id="toc-why-filter" class="nav-link active" data-scroll-target="#why-filter"><span class="header-section-number">5.1</span> Why Filter?</a></li>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">5.2</span> Learning Objectives</a></li>
  <li><a href="#filtering-in-the-gui" id="toc-filtering-in-the-gui" class="nav-link" data-scroll-target="#filtering-in-the-gui"><span class="header-section-number">5.3</span> Filtering in the GUI</a></li>
  <li><a href="#sample-data-for-demonstration-purposes" id="toc-sample-data-for-demonstration-purposes" class="nav-link" data-scroll-target="#sample-data-for-demonstration-purposes"><span class="header-section-number">5.4</span> Sample Data for Demonstration Purposes</a>
  <ul class="collapse">
  <li><a href="#downloading-the-sample-data" id="toc-downloading-the-sample-data" class="nav-link" data-scroll-target="#downloading-the-sample-data"><span class="header-section-number">5.4.1</span> Downloading the Sample Data</a></li>
  <li><a href="#samples" id="toc-samples" class="nav-link" data-scroll-target="#samples"><span class="header-section-number">5.4.2</span> Samples</a></li>
  <li><a href="#genes" id="toc-genes" class="nav-link" data-scroll-target="#genes"><span class="header-section-number">5.4.3</span> Genes</a></li>
  <li><a href="#sample-properties" id="toc-sample-properties" class="nav-link" data-scroll-target="#sample-properties"><span class="header-section-number">5.4.4</span> Sample Properties</a></li>
  <li><a href="#variant-properties" id="toc-variant-properties" class="nav-link" data-scroll-target="#variant-properties"><span class="header-section-number">5.4.5</span> Variant Properties</a></li>
  </ul></li>
  <li><a href="#advanced-boolean-operations" id="toc-advanced-boolean-operations" class="nav-link" data-scroll-target="#advanced-boolean-operations"><span class="header-section-number">5.5</span> Advanced: Boolean Operations</a>
  <ul class="collapse">
  <li><a href="#adding-another-filter" id="toc-adding-another-filter" class="nav-link" data-scroll-target="#adding-another-filter"><span class="header-section-number">5.5.1</span> Adding Another Filter</a></li>
  <li><a href="#and-logic" id="toc-and-logic" class="nav-link" data-scroll-target="#and-logic"><span class="header-section-number">5.5.2</span> AND Logic</a></li>
  <li><a href="#or-logic" id="toc-or-logic" class="nav-link" data-scroll-target="#or-logic"><span class="header-section-number">5.5.3</span> OR Logic</a></li>
  <li><a href="#grouping-with-parentheses" id="toc-grouping-with-parentheses" class="nav-link" data-scroll-target="#grouping-with-parentheses"><span class="header-section-number">5.5.4</span> Grouping With Parentheses</a></li>
  <li><a href="#combining-and-or-logic" id="toc-combining-and-or-logic" class="nav-link" data-scroll-target="#combining-and-or-logic"><span class="header-section-number">5.5.5</span> Combining <strong>AND</strong> / <strong>OR</strong> Logic</a></li>
  <li><a href="#not-logic" id="toc-not-logic" class="nav-link" data-scroll-target="#not-logic"><span class="header-section-number">5.5.6</span> NOT Logic</a></li>
  <li><a href="#deleting-a-filter" id="toc-deleting-a-filter" class="nav-link" data-scroll-target="#deleting-a-filter"><span class="header-section-number">5.5.7</span> Deleting a Filter</a></li>
  </ul></li>
  <li><a href="#exporting-filters-as-json" id="toc-exporting-filters-as-json" class="nav-link" data-scroll-target="#exporting-filters-as-json"><span class="header-section-number">5.6</span> Exporting Filters as JSON</a></li>
  <li><a href="#applying-json-filters-in-the-gui" id="toc-applying-json-filters-in-the-gui" class="nav-link" data-scroll-target="#applying-json-filters-in-the-gui"><span class="header-section-number">5.7</span> Applying JSON Filters in the GUI</a></li>
  <li><a href="#applying-json-filters-on-the-command-line" id="toc-applying-json-filters-on-the-command-line" class="nav-link" data-scroll-target="#applying-json-filters-on-the-command-line"><span class="header-section-number">5.8</span> Applying JSON Filters on the Command Line</a></li>
  <li><a href="#what-you-learned" id="toc-what-you-learned" class="nav-link" data-scroll-target="#what-you-learned"><span class="header-section-number">5.9</span> What You Learned</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Filtering in OpenCRAVAT</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="why-filter" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="why-filter"><span class="header-section-number">5.1</span> Why Filter?</h2>
<p>Filtering your annotated variants lets you query interesting subsets of your variants.</p>
<p>A secondary purpose of filtering is when you want to view your results in the results viewer and you have more than 100K variants.</p>
</section>
<section id="learning-objectives" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">5.2</span> Learning Objectives</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
  A["Results Viewer"] --&gt; B
  B["Build Filter in GUI"] 
  B --&gt; F["Explore Filtered Data"]
  F --&gt; G["Save JSON filter"]
  G --&gt; D["Apply filter to New Set"]
  G --&gt; E["Apply Filter on CLI"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>After reading this vignette, you should be able to:</p>
<ul>
<li><strong>Explain</strong> how to build simple filters using the OpenCRAVAT GUI</li>
<li><strong>Compose</strong> multiple filters using boolean logic to make complex filtering</li>
<li><strong>Save</strong> your filter and <strong>export</strong> it as a JSON file</li>
<li><strong>Apply</strong> your filter to a new set of variants</li>
</ul>
</section>
<section id="filtering-in-the-gui" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="filtering-in-the-gui"><span class="header-section-number">5.3</span> Filtering in the GUI</h2>
<p>Once you have your annotated results, you can filter variants in the results viewer. There are 4 kinds of filters:</p>
<ul>
<li>Samples</li>
<li>Genes</li>
<li>Sample Properties</li>
<li>Variant Properties</li>
</ul>
<p>We will go through each of these filters and their functionality after we talk about the common GUI elements of each.</p>
</section>
<section id="sample-data-for-demonstration-purposes" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="sample-data-for-demonstration-purposes"><span class="header-section-number">5.4</span> Sample Data for Demonstration Purposes</h2>
<p>We will use a subset of a synthetic dataset that is a trio. There are 5 individuals in this dataset.</p>
<ol type="1">
<li>The Proband</li>
<li>Mother</li>
<li>Father</li>
<li>Sibling 1</li>
<li>Sibling 2</li>
</ol>
<p>Some of the variants are shared by the Proband and Mother, and all other combinations. We will leverage these different combinations in our example below.</p>
<section id="downloading-the-sample-data" class="level3" data-number="5.4.1">
<h3 data-number="5.4.1" class="anchored" data-anchor-id="downloading-the-sample-data"><span class="header-section-number">5.4.1</span> Downloading the Sample Data</h3>
<p>You can download the sample result file here: <a href="https://github.com/laderast/oc_vignettes/raw/main/data/Session2.filtered.sqlite">Synthetic Trio Dataset</a></p>
<p>On the command line, you can download it into your current directory with <code>wget</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> https://github.com/laderast/oc_vignettes/raw/main/data/Session2.filtered.sqlite</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When you’re ready, open up the file with <code>oc gui</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">oc</span> gui Session2.filtered.sqlite</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="samples" class="level3" data-number="5.4.2">
<h3 data-number="5.4.2" class="anchored" data-anchor-id="samples"><span class="header-section-number">5.4.2</span> Samples</h3>
<p>You can remove variants associated with a set of sample IDs by clicking on the checkboxes here. For example, we want all of the variants that are associated with the mother. We’ll click on the “mother” checkbox until it is a green check.</p>
<p><img src="images/mother-filter1.png" class="img-fluid"> If we look at the Variant tab, we can see that our variants include multiple members:</p>
<p><img src="images/mother-all-result.png" class="img-fluid"> Here’s a visual summary of the results.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"] --"Sample:mother"--&gt; B
  B["Mother Variants\n(n=1187)"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>These are all of the variants that are associated with the mother, and include variants that are shared by other family members. What about variants that are <em>exclusive</em> to the mother?</p>
<p>For example, we can filter for</p>
<p>To exclude samples, click on the checkbox until you see a red x.</p>
<p><img src="images/mother-exclusive-filter.png" class="img-fluid"> After filtering, we find that 385 variants are exclusive to the mother. We can confirm this by going to the <strong>Variant</strong> tab:</p>
<p><img src="images/mother-exclusive-result.png" class="img-fluid"> Here’s the visual summary:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"] --"Sample:mother\nExclude:others"--&gt; B
  B["Mother Variants\n(n=385)"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="genes" class="level3" data-number="5.4.3">
<h3 data-number="5.4.3" class="anchored" data-anchor-id="genes"><span class="header-section-number">5.4.3</span> Genes</h3>
<p>Gene-level filtering can be done here. You can input a list of genes, separated by line-breaks.</p>
<p>Clearing our previous filter, let’s filter to only those variants that are in BRCA1 and BRCA2.</p>
<p>To filter, we take the following steps in the <strong>Gene</strong> filter section:</p>
<ol type="1">
<li>Enter a list of genes, 1 gene per line in the text box. You can also upload a list of genes as well.</li>
<li>Apply the filter</li>
<li>See the results. There are 63 variants associated with BRCA1/BRCA2.</li>
</ol>
<p><img src="images/gene-filter.png" class="img-fluid"> Going to the <strong>Variant</strong> tab, we can confirm that the variants belong to BRCA1 and BRCA2.</p>
<p><img src="images/gene-filter-result.png" class="img-fluid"> Here’s the visual summary of the filter:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"] --"Gene:(BRCA1,BRCA2)"--&gt; B
  B["BRCA1/BRCA2 Genes\n(n=63)"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="sample-properties" class="level3" data-number="5.4.4">
<h3 data-number="5.4.4" class="anchored" data-anchor-id="sample-properties"><span class="header-section-number">5.4.4</span> Sample Properties</h3>
</section>
<section id="variant-properties" class="level3" data-number="5.4.5">
<h3 data-number="5.4.5" class="anchored" data-anchor-id="variant-properties"><span class="header-section-number">5.4.5</span> Variant Properties</h3>
<p>In variant properties, you can filter by variant type based on your annotations. For example, let’s filter our dataset to missense variants.</p>
<p>A. Under <strong>Variant Properties</strong>:</p>
<ol type="1">
<li>Click on “Query Builder”.</li>
<li>Mouse into the left bottom corner of the query builder window, and click the “+” sign.</li>
</ol>
<p><img src="images/variant-filter.png" class="img-fluid"></p>
<p>B. Make your filter by selecting the values for the following dropdown boxes:</p>
<ol type="1">
<li>Variant Annotation</li>
<li>Sequence Ontology</li>
<li>One of</li>
<li>Missense checkbox</li>
</ol>
<p><img src="images/variant-filter2.png" class="img-fluid"> C. Finally, click the “Apply Filter” Button:</p>
<p><img src="images/variant-apply-filter.png" class="img-fluid"></p>
<p>You will be left with 299 variants. Here’s a visual summary of what we did:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"] --"Sequence Ontology:\nMissense"--&gt; B["Missense Variants\n(n=299)"]
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-boolean-operations" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="advanced-boolean-operations"><span class="header-section-number">5.5</span> Advanced: Boolean Operations</h2>
<p>You can build more sophisticated operations by combining each filter step using Boolean logic.</p>
<section id="adding-another-filter" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="adding-another-filter"><span class="header-section-number">5.5.1</span> Adding Another Filter</h3>
<p>You can add another filter by clicking the <strong>+</strong> underneath your filter.</p>
<p><img src="images/add-filter.png" class="img-fluid"></p>
</section>
<section id="and-logic" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="and-logic"><span class="header-section-number">5.5.2</span> AND Logic</h3>
<p>By default, the filters are combined using <strong>AND</strong> logic, which are more restrictive, because they require variants to meet both filters.</p>
<p>Here’s an example of using <strong>AND</strong> logic. Here we are combining two filters: Missense Variants (from <strong>Variant Annotation &gt;&gt; Sequence Ontology</strong>) and Pathogenic variants (from <strong>ClinVar &gt;&gt; Clinical Significance</strong>).</p>
<p><img src="images/and-filter.png" class="img-fluid"> Then do the following:</p>
<ol type="1">
<li>Select “ClinVar”</li>
<li>Select “Clinical Significance”</li>
<li>Select “One of”</li>
<li>Select “Pathogenic”</li>
<li>Click “Filter Result”</li>
</ol>
<p><img src="images/add-filter2.png" class="img-fluid"> If we look at the <strong>Variant</strong> tab, we can see that our combined filter selected both Pathogenic and Missense Variants.</p>
<p><img src="images/add-filter-result.png" class="img-fluid"></p>
<p>When we apply the filter, we get 9 variants that meet both criteria. Here’s a visual summary of the filtering:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"] --"Sequence Ontology:\nmissense"--&gt; B["Missense Variants\(n=299)"]
  A --"Clinical Significance:\nPathogenic"--&gt; C["Pathogenic Variants\n(n=10)"]
  B --"AND"--&gt; E["Pathogenic AND Missense\n(n=9)"]
  C --"AND"--&gt; E
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="or-logic" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="or-logic"><span class="header-section-number">5.5.3</span> OR Logic</h3>
<p>These filters can also be combined using <strong>OR</strong> logic, which is more permissive (that is, these filters will return a greater number than the <strong>AND</strong> logic) we might want variants that are either missense <strong>OR</strong> pathogenic.</p>
<p>We can do this by clicking the “and” that links our two filters, which will switch it to an “or”:</p>
<p><img src="images/or-filter.png" class="img-fluid"> When we apply the filter, we get 300 variants. The breakdown is below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"] --"Sequence Ontology:\nmissense"--&gt; B["Missense Variants\n(n=299)"]
  A --"Clinical Significance:\nPathogenic"--&gt; C["Pathogenic Variants\n(n=10)"]
  B --"OR"--&gt; E["Pathogenic OR Missense\n(n=300)"]
  C --"OR"--&gt; E
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="grouping-with-parentheses" class="level3" data-number="5.5.4">
<h3 data-number="5.5.4" class="anchored" data-anchor-id="grouping-with-parentheses"><span class="header-section-number">5.5.4</span> Grouping With Parentheses</h3>
<p>We can use the parentheses to group filters together. This can be helpful when we combine different types of logic.</p>
<p>To make a grouped filter, click the <strong>(</strong> button next to the <strong>+</strong> button in the interface:</p>
<p><img src="images/parentheses-filter1.png" class="img-fluid"></p>
<p>Then you can build a set of filters much like above. Notice that they are grouped within a set of parentheses.</p>
<p><img src="images/parentheses-filter2.png" class="img-fluid"> Keep in mind that you can nest parentheses within parentheses to make even more complex filters. We’ll use this to be able to combine three filters with <strong>AND</strong> and <strong>OR</strong> logic below.</p>
</section>
<section id="combining-and-or-logic" class="level3" data-number="5.5.5">
<h3 data-number="5.5.5" class="anchored" data-anchor-id="combining-and-or-logic"><span class="header-section-number">5.5.5</span> Combining <strong>AND</strong> / <strong>OR</strong> Logic</h3>
<p>By default, when you click the “and” / “or” of one set of filters, all filters will be changed. If you want to combine <strong>AND</strong> / <strong>OR</strong> logic, you can group one of the logic operations using parentheses.</p>
<p>For example, say we want the above <strong>OR</strong> subset combined as an <strong>AND</strong> with those variants that have PS1 evidence.</p>
<p>This is what our final filter looks like:</p>
<p><img src="images/and-or-filter.png" class="img-fluid"> Here’s a visual breakdown of this complex filter:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TD
  A["All Variants\n(n=1,738)"]--"Sequence Ontology:\nmissense"--&gt; B
  A --"Clinical Significance:\nPathogenic"--&gt; C
  subgraph OR
  B["Missense Variants\n(n=299)"]
  C["Pathogenic Variants\n(n=10)"]
  B --"OR"--&gt; E["Pathogenic OR Missense\n(n=300)"]
  C --"OR"--&gt; E
  end
  F["PS1 Variants\n(n=27)"]
  E --"AND"--&gt; G["PS1 Variants AND\n(Missense OR Pathogenic)\n(n=27)"]
  A --"ClinVar ACMG\nPS1 variants"--&gt; F
  F --"AND"--&gt; G
  classDef White fill:#FFFFFF;
  class OR White
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</section>
<section id="not-logic" class="level3" data-number="5.5.6">
<h3 data-number="5.5.6" class="anchored" data-anchor-id="not-logic"><span class="header-section-number">5.5.6</span> NOT Logic</h3>
<p>If we mouse over the top left of a filter or filter group, we’ll see a faint “NOT”.</p>
<p><img src="images/not-filter1.png" class="img-fluid"></p>
<p>Clicking this will change the logic to <strong>NOT</strong>.</p>
<p><img src="images/not-filter2.png" class="img-fluid"></p>
<p>Then we can hit <strong>Apply Filter</strong> again. In our case, we have 1,729 variants that do not meet our filter criterion. This makes sense because there were 9 variants total that met our grouped criterion, and 1,738 variants total, and 1738 - 9 = 1729.</p>
</section>
<section id="deleting-a-filter" class="level3" data-number="5.5.7">
<h3 data-number="5.5.7" class="anchored" data-anchor-id="deleting-a-filter"><span class="header-section-number">5.5.7</span> Deleting a Filter</h3>
<p>Finally, if you need to delete a filter, you can mouse to the right of the filter. A faint “X” will appear. Clicking on it will delete that filter.</p>
<p><img src="images/filter-delete.png" class="img-fluid"></p>
</section>
</section>
<section id="exporting-filters-as-json" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="exporting-filters-as-json"><span class="header-section-number">5.6</span> Exporting Filters as JSON</h2>
<p>Filters can be exported and saved as JSON files for further reuse. They can be applied to a new set of variants in the GUI, or can be applied to result SQLite files on the command line.</p>
<p>To export your filters, click on the save icon in the bottom right:</p>
<p><img src="images/save-filter.png" class="img-fluid"> A modal box will pop up and ask you to name your filter set:</p>
<p><img src="images/save-filter-name.png" class="img-fluid"></p>
<p>When you click <strong>OK</strong>, the filter will be saved on the top right:</p>
<p><img src="images/saved-filter.png" class="img-fluid"></p>
<p>Finally, you can click on the download button for the individual filter to save it to disk:</p>
<p><img src="images/saved-filter_download.png" class="img-fluid"></p>
<p>Here’s an example of what a filter looks like in the JSON format:</p>
<pre><code>{
  "sample": {
    "require": [],
    "reject": []
  },
  "genes": [],
  "variant": {
    "operator": "and",
    "rules": [
      {
        "operator": "and",
        "rules": [
          {
            "column": "clinvar__sig",
            "test": "hasData",
            "value": null,
            "negate": false
          },
          {
            "column": "clingen__disease",
            "test": "hasData",
            "value": null,
            "negate": false
          }
        ],
        "negate": false
      }
    ],
    "negate": false
  },
  "smartfilter": {},
  "samplefilter": {
    "operator": "and",
    "rules": [],
    "negate": false
  }
}</code></pre>
</section>
<section id="applying-json-filters-in-the-gui" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="applying-json-filters-in-the-gui"><span class="header-section-number">5.7</span> Applying JSON Filters in the GUI</h2>
<p>JSON filters can be applied by clicking on the upload icon:</p>
<p><img src="images/upload-filter.png" class="img-fluid"></p>
<p>A file select box will pop up and you can select the JSON filter to load it:</p>
<p><img src="images/upload-dialog.png" class="img-fluid"></p>
<p>Then you can hit <strong>Apply Filter</strong> as usual to apply it.</p>
</section>
<section id="applying-json-filters-on-the-command-line" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="applying-json-filters-on-the-command-line"><span class="header-section-number">5.8</span> Applying JSON Filters on the Command Line</h2>
<p>JSON filters can also be applied on the command-line using the <code>oc util filtersqlite</code> command. <a href="https://open-cravat.readthedocs.io/en/latest/Filter-And-Merge-SQLite.html">More information is here</a>.</p>
</section>
<section id="what-you-learned" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="what-you-learned"><span class="header-section-number">5.9</span> What You Learned</h2>
<ul>
<li><strong>Explain</strong> how to build simple filters using the OpenCRAVAT GUI</li>
<li><strong>Compose</strong> multiple filters using boolean logic to make complex filtering</li>
<li><strong>Save</strong> your filter and <strong>export</strong> it as a JSON file</li>
<li><strong>Apply</strong> your filter to a new set of variants</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./making_annotator_modules.html" class="pagination-link" aria-label="Making an Annotator Module">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Making an Annotator Module</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->




</body></html>